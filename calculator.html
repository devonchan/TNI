<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>TNI Supplement Calculator</title>

    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .radio-inline {
            margin: 0px 5px;
        }
    </style>
</head>

<body>

    <div class="container">

        <div class="jumbotron" style="margin-top: 20px;">
            <h1 class="display-3">TNI Supplement Calculator</h1>
            <p class="lead">
                This calculator will provide a suggested dosing schedule for the basic TNI protocol. 
                This includes Nutrivene-D Daily Antioxidant, Nutrivene Polyphenol Support, Longvida Curcumin, 
                Nutrivene Enzymes, Nutrivene Nighttime, and DHA.
                <br> <br>               
                I designed this for my personal reference only. Use at your own risk.
            </p>
        </div>
        

        <div class="row">
            <div class="col">
                <p>
                    When beginning a new supplement, start at 1/4 - 1/2 dose. Work up to a full dose over a period of two weeks or more. Phase in one new supplement at a time. Start with NVD, followed by Polyphenol support and curcumin (these can be phased in together), then others as desired.
                    <br><br>If the subject suffers from reflux, you should investigate whether or not enzymes will be helpful. 
                    To get the enzyme dosage, select "No" for the reflux question.<br><br>
                    Check your Polyphenol bottle carefully. If your Polyphenol does NOT contain EGCG, you will have to add it separately. EGCG is dosed at 5mg/kg.

                </p>
            </div>
        </div>
        <div class="row offset-md-4 mt-2">
            <div class="col">
                <label>Body Weight</label>
            </div>
        </div>
        <div class="row">
            <div class="col-4 offset-md-4 col-md-2">
                <input id="bodyweight-input" type="text" class="form-control decimal">
            </div>
            <div class="col-4">
                <div class="mt-2">
                    <label class="radio-inline">
                        <input type="radio" name="bodyweight-unit" value="lb" checked>lb
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="bodyweight-unit" value="kg">kg
                    </label>
                </div>
            </div>
        </div>


        <div class="row mt-4">
            <div class="col offset-md-4">
                <label>Does the subject suffer from reflux?</label>
            </div>
        </div>

        <div class="row">
            <div class="col offset-md-4">
                <div class="radio">
                    <input type="radio" name="has-reflux-btn" id="" value="true">
                    <label for="radhas-reflux-btn-yesio1">Yes</label>
                </div>
                <div class="radio">
                    <input type="radio" name="has-reflux-btn" value="false" checked>
                    <label for="has-reflux-btn-no">No</label>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col offset-md-4">
                <label>Is the subject eating solid foods?</label>
            </div>
        </div>

        <div class="row">
            <div class="col offset-md-4">
                <div class="radio">
                    <input type="radio" name="eat-solids-btn" id="eat-solids-btn-yes" value="true" checked>
                    <label for="eat-solids-btn-yes">Yes</label>
                </div>
                <div class="radio">
                    <input type="radio" name="eat-solids-btn" id="eat-solids-btn-no" value="false">
                    <label for="eat-solids-btn-no">No</label>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col offset-md-4">
                <label>How many dosing opportunities are there per day which are a minimum of 4 hours apart?</label>
            </div>
        </div>

        <div class="row">
            <div class="col offset-md-4">
                <div class="radio">
                    <input type="radio" name="dosing-ops-btn" id="dosing-ops-btn-2" value="2" checked>
                    <label for="dosing-ops-btn-2">2 (morning & evening)</label>
                </div>
                <div class="radio">
                    <input type="radio" name="dosing-ops-btn" id="dosing-ops-btn-3" value="3">
                    <label for="dosing-ops-btn-3">3 (morning, midday & evening)</label>
                </div>
                <div class="radio">
                    <input type="radio" name="dosing-ops-btn" id="dosing-ops-btn-4" value="4">
                    <label for="dosing-ops-btn-4">4 (morning, midday, afternoon & evening)</label>
                </div>
            </div>
        </div>

        <div class="row offset-md-4 mt-2">
            <div class="col">
                <label>How many milligrams per capsule, scoop, ml, etc. of curcumin?
                <br>
                For Nutrivene Curcumin, enter 1000 for white scoop, or 725 for 1/4 tsp measuring spoon</label>
            </div>
        </div>
        <div class="row">
            <div class="col-4 offset-md-4 col-md-2">
                <input id="curcumin-input" type="text" class="form-control decimal">
            </div>
            <div class="col-4">
                <div class="mt-2">
                    <p>mg</p>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col offset-md-4">
                <label>Which Polyphenol formula are you using?</label>
            </div>
        </div>        
       
         <div class="row">
            <div class="col offset-md-4">
                <div class="radio">
                    <input type="radio" name="poly-egcg-btn" id="poly-egcg-btn-yes" value="true">
                    <label for="poly-egcg-yes">With EGCG</label>
                </div>
                <div class="radio">
                    <input type="radio" name="poly-egcg-btn" id="poly-egcg-btn-no" value="false" checked>
                    <label for="poly-egcg-btn-no">Without EGCG</label>
                </div>
            </div>
        </div>
        
        <div class="row offset-md-4 mt-2">
            <div class="col">
                <label>IF using separate EGCG, how many milligrams per capsule, scoop, ml, etc.?
                    <br>
                    For Nutrivene Green Tea Extract, enter 112.5</label>
            </div>
        </div>
        <div class="row">
            <div class="col-4 offset-md-4 col-md-2">
                <input id="egcg-input" type="text" class="form-control decimal">
            </div>
            <div class="col-4">
                <div class="mt-2">
                    <p>mg</p>
                </div>
            </div>
        </div>
        
        <div class="row mt-4 offset-md-4">
            <div class="col">
                <button id="calculate-btn" type="button" class="btn btn-default">Calculate</button>
            </div>
        </div>

        <div id="dosages-div" class="row mt-4 offset-md-4" hidden>
            <div class="col-md-8">
                <div class="card">
                    <h3 class="card-header">
                        Dosage
                    </h3>
                    <div id="result-div"></div>
                    <div class="row mt-1 mb-1">
                        <div class="col mr-2">
                            <button id="print-btn" type="button" class="float-right btn btn-default">Print</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer mt-5">
            <p>&copy; Devon Chan 2017</p>
        </footer>
        
        <div id="print-div" hidden>
            <h3>
                Nutrition Calculator
            </h3>
            <p>When beginning a new supplement, start at 1/4 - 1/2 dosage. Work up to a full dose over a period of two weeks or more. 
                Phase in one new supplement at a time. Start with NVD, followed by Polyphenol support and curcumin
                (these can be phased in together), then others as desired.</p>
            <h3>
                Dosage
            </h3>
            <div id="print-result-div"></div>
            <footer>
                <p>&copy; Devon Chan 2017</p>
            </footer>
        </div>

    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>

    <script type="text/javascript">
        var calculateResult = function () {
            var bodyweightInKg = parseFloat($("#bodyweight-input").val());
            var bodyweightIsLbs = $("input[name=bodyweight-unit]:checked").val() == "lb"; //true if lb is checked, false if kg is checked
            if (bodyweightIsLbs) {
                bodyweightInKg = bodyweightInKg / 2.20462;
            }

            if (!bodyweightInKg) {
                $("#result-div").html("");
                $("#print-result-div").html("");
            }

            var mgCurcuminPerCaps = parseFloat($("#curcumin-input").val());
            var mgEgcgPerCaps = parseFloat($("#egcg-input").val());

            var canHaveEnzyme = $("input[name=has-reflux-btn]:checked").val() == "false" &&
                $("input[name=eat-solids-btn]:checked").val() == "true";
            
            var withoutEgcg = $("input[name=poly-egcg-btn]:checked").val() == "false";
            var withEgcg = $("input[name=poly-egcg-btn]:checked").val() == "true";

            var polyphenolDose = { 'cap': bodyweightInKg / 17 };
            var curcuminDose = { 'mg': bodyweightInKg * 30};
            var egcgDose = { 'mg': bodyweightInKg * 5};
            var visbiomeDose = { 'pkg': bodyweightInKg / 68, 'cap': bodyweightInKg / 17 };

            if (mgCurcuminPerCaps) {
                curcuminDose.cap = (bodyweightInKg * 30) / mgCurcuminPerCaps; }
            if (mgEgcgPerCaps) {
                egcgDose.cap = (bodyweightInKg * 5) / mgEgcgPerCaps; }

            var nutriveneDose = null;
            var enzymeDose = null;

            // Nutrivene & Enzyme
            if (bodyweightInKg < 5.0) {
                nutriveneDose = { 'tsp': 0.25, 'cap': 1 };
                enzymeDose = { 'cap': 1 };
            } else if (bodyweightInKg < 9.0) {
                nutriveneDose = { 'tsp': 0.5, 'cap': 2 };
                enzymeDose = { 'cap': 1 };
            } else if (bodyweightInKg < 18.0) {
                nutriveneDose = { 'tsp': 0.75, 'cap': 4 };
                enzymeDose = { 'cap': 1 };
            } else if (bodyweightInKg < 27.0) {
                nutriveneDose = { 'tsp': 1.0, 'cap': 6 };
                enzymeDose = { 'cap': 2 };
            } else if (bodyweightInKg < 36.0) {
                nutriveneDose = { 'tsp': 1.5, 'cap': 9 };
                enzymeDose = { 'cap': 2 };
            } else {
                nutriveneDose = { 'tsp': 2, 'cap': 12 };
                enzymeDose = { 'cap': 3 };
            };

            // Nighttime
            if (bodyweightInKg < 7.0) {
                nighttimeDose = { 'cap': 0.25 };
            } else if (bodyweightInKg < 11.0) {
                nighttimeDose = { 'cap': 0.5 };
            } else if (bodyweightInKg < 16.0) {
                nighttimeDose = { 'cap': 1.0 };
            } else if (bodyweightInKg < 22.5) {
                nighttimeDose = { 'cap': 1.5 };
            } else if (bodyweightInKg < 32.0) {
                nighttimeDose = { 'cap': 2.0 };
            } else {
                nighttimeDose = { 'cap': 3.0 };
            };

            var numberOfDosages = parseInt($("input[name=dosing-ops-btn]:checked").val());

            var html = "";
            var printHtml = "";
            if (numberOfDosages == 2) {
                //Morning
                var mornDosageItems = [
                    { 'name': 'Nutrivene', 'dose': nutriveneDose, 'amount': 1 },
                    { 'name': 'Visbiome', 'dose': visbiomeDose, 'amount': 1 }
                    { 'name': 'Mango or Papaya powder', 'dose': { 'value': "according to symptoms" } }
                ];
                if (canHaveEnzyme) { mornDosageItems.push({ 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 0.5 }); }

                html += resultBlock("Morning", mornDosageItems);
                printHtml += resultPrintBlock("Morning", mornDosageItems);

                //Evening
                var eveDosageItems = [
                    { 'name': 'Polyphenol', 'dose': polyphenolDose, 'amount': 1 },
                    { 'name': 'Curcumin', 'dose': curcuminDose, 'amount': 1 },
                    { 'name': 'Nighttime Formula', 'dose': nighttimeDose, 'amount': 1 },
                    { 'name': 'DHA', 'dose': egcgDose, 'amount': 1 }                  
                ];
                if (canHaveEnzyme) { eveDosageItems.splice(3, 0, { 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 0.5 }); }
                if (withoutEgcg) { eveDosageItems.push({ 'name': 'EGCG', 'dose': egcgDose, 'amount': 1 }); }

                html += resultBlock("Evening", eveDosageItems);
                printHtml += resultPrintBlock("Evening", eveDosageItems);

            } else if (numberOfDosages == 3) {
                if (withoutEgcg)  {
                    //Morning
                    var mornDosageItems = [
                        { 'name': 'Nutrivene', 'dose': nutriveneDose, 'amount': 0.5 },
                        { 'name': 'Polyphenol', 'dose': polyphenolDose, 'amount': 1 },
                        { 'name': 'Visbiome', 'dose': visbiomeDose, 'amount': 1 }
                        { 'name': 'Mango or Papaya powder', 'dose': { 'value': "according to symptoms" } }
                    ];
                    if (canHaveEnzyme) { mornDosageItems.push({ 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 1 / 3 }); }

                    html += resultBlock("Morning", mornDosageItems);
                    printHtml += resultPrintBlock("Morning", mornDosageItems);

                    //Midday
                    var middayDosageItems = [{ 'name': 'EGCG', 'dose': egcgDose, 'amount': 1 }];
                    if (canHaveEnzyme) { middayDosageItems.push({ 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 1 / 3 }); }

                    html += resultBlock("Midday", middayDosageItems);
                    printHtml += resultPrintBlock("Midday", middayDosageItems);

                    //Evening
                    var eveDosageItems = [
                        { 'name': 'Nutrivene', 'dose': nutriveneDose, 'amount': 0.5 },
                        { 'name': 'Polyphenol', 'dose': polyphenolDose, 'amount': 1 },
                        { 'name': 'Curcumin', 'dose': curcuminDose, 'amount': 1 },
                        { 'name': 'Nighttime Formula', 'dose': nighttimeDose, 'amount': 1 },
                        { 'name': 'DHA', 'dose': egcgDose, 'amount': 1 }
                    ];
                    if (canHaveEnzyme) { eveDosageItems.splice(2, 0, { 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 1 / 3 }); }              

                    html += resultBlock("Evening", eveDosageItems);
                    printHtml += resultPrintBlock("Evening", eveDosageItems); 
                }
                
                else if (withEgcg)  {
                    //Morning
                    var mornDosageItems = [
                        { 'name': 'Nutrivene', 'dose': nutriveneDose, 'amount': 0.5 },
                        { 'name': 'Visbiome', 'dose': visbiomeDose, 'amount': 1 }
                        { 'name': 'Mango or Papaya powder', 'dose': { 'value': "according to symptoms" } }
                    ];
                    if (canHaveEnzyme) { mornDosageItems.push({ 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 1 / 3 }); }

                    html += resultBlock("Morning", mornDosageItems);
                    printHtml += resultPrintBlock("Morning", mornDosageItems);

                    //Midday
                    var middayDosageItems = [{ 'name': 'Nutrivene', 'dose': nutriveneDose, 'amount': 0.5 }];
                    if (canHaveEnzyme) { middayDosageItems.push({ 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 1 / 3 }); }

                    html += resultBlock("Midday", middayDosageItems);
                    printHtml += resultPrintBlock("Midday", middayDosageItems);

                    //Evening
                    var eveDosageItems = [
                        { 'name': 'Polyphenol', 'dose': polyphenolDose, 'amount': 1 },
                        { 'name': 'Curcumin', 'dose': curcuminDose, 'amount': 1 },
                        { 'name': 'Nighttime Formula', 'dose': nighttimeDose, 'amount': 1 },
                        { 'name': 'DHA', 'dose': egcgDose, 'amount': 1 }
                    ];
                    if (canHaveEnzyme) { eveDosageItems.splice(2, 0, { 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 1 / 3 }); }              

                    html += resultBlock("Evening", eveDosageItems);
                    printHtml += resultPrintBlock("Evening", eveDosageItems); 
                }  
            } else if (numberOfDosages == 4) {
                //Morning
                var mornDosageItems = [
                    { 'name': 'Nutrivene', 'dose': nutriveneDose, 'amount': 0.5 },
                    { 'name': 'Visbiome', 'dose': visbiomeDose, 'amount': 1 }
                    { 'name': 'Mango or Papaya powder', 'dose': { 'value': "according to symptoms" } }
                ];
                if (canHaveEnzyme) { mornDosageItems.push({ 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 1 / 3 }); }

                html += resultBlock("Morning", mornDosageItems);
                printHtml += resultPrintBlock("Morning", mornDosageItems);

                //Midday
                var middayDosageItems = [
                    { 'name': 'Polyphenol', 'dose': polyphenolDose, 'amount': 1 },
                    { 'name': 'Curcumin', 'dose': curcuminDose, 'amount': 0.5 }];
                if (canHaveEnzyme) { middayDosageItems.push({ 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 1 / 3 }); }
                if (withoutEgcg) { middayDosageItems.push({ 'name': 'EGCG', 'dose': egcgDose, 'amount': 1 }); }
                
                html += resultBlock("Midday", middayDosageItems);
                printHtml += resultPrintBlock("Midday", middayDosageItems);

                //Afternoon
                var aftDosageItems = [{ 'name': 'Nutrivene', 'dose': nutriveneDose, 'amount': 0.5 }];
                if (canHaveEnzyme) { aftDosageItems.push({ 'name': 'Enzyme', 'dose': enzymeDose, 'amount': 1 / 3 }); }

                html += resultBlock("Afternoon", aftDosageItems);
                printHtml += resultPrintBlock("Afternoon", aftDosageItems);

                //Evening
                var eveDosageItems = [
                    { 'name': 'Polyphenol', 'dose': polyphenolDose, 'amount': 1 },
                    { 'name': 'Curcumin', 'dose': curcuminDose, 'amount': 0.5 },
                    { 'name': 'Nighttime Formula', 'dose': nighttimeDose, 'amount': 1 },
                    { 'name': 'DHA', 'dose': egcgDose, 'amount': 1 }
                ];

                html += resultBlock("Evening", eveDosageItems);
                printHtml += resultPrintBlock("Evening", eveDosageItems);
            };
            $("#result-div").html(html);
            $("#print-result-div").html(printHtml);
        };

        var resultBlock = function (timeOfDay, dosageItems) {
            var body = "";
            _.each(dosageItems, function (dosageItem) {
                if (dosageItem.dose.cap == 0) { return; }
                body = body + resultItem(dosageItem);
            });

            return "<div class=\"card-block\"><h5 class=\"card-title\">" + timeOfDay + "</h5><div>" + body + "</div></div>";
        };

        var resultItem = function (dosageItem) {
            return "<div class=\"row mt-1\"><div class=\"col\"><div class=\"input-group\"><span class=\"input-group-addon\" >" +
                "<strong>" + dosageItem.name + ":</strong></span>" +
                "<input type=\"text\" class=\"form-control\" value=\"" + formatAmount(dosageItem) + "\" readonly></div></div></div>";
        };

        var resultPrintBlock = function (timeOfDay, dosageItems) {
            var body = "";
            _.each(dosageItems, function (dosageItem) {
                if (dosageItem.dose.cap == 0) { return; }
                body = body + resultPrintItem(dosageItem);
            });

            return "<div><h5>" + timeOfDay + "</h5><table>" + body + "</table></div>";
        };

        var resultPrintItem = function (dosageItem) {
            return "<tr><td>" + dosageItem.name + ": </td><td>" + formatAmount(dosageItem) + "</td></tr>";
        };

        var formatAmount = function (dosageItem) {
            if ('value' in dosageItem.dose) {
                return dosageItem.dose.value;
            }

            var amountStr = "";
            if ('mg' in dosageItem.dose) {
                amountStr += Math.floor(dosageItem.dose.mg * dosageItem.amount) + " mg";
            }
            if ('tsp' in dosageItem.dose) {
                if (amountStr != "") {
                    amountStr += " or ";
                }
                amountStr += decimalToFraction(dosageItem.dose.tsp * dosageItem.amount) + " tsp";
            }
            if ('cap' in dosageItem.dose) {
                if (amountStr != "") {
                    amountStr += " or ";
                }
                amountStr += decimalToFraction(dosageItem.dose.cap * dosageItem.amount) + " capsule";
                if (dosageItem.dose.cap * dosageItem.amount > 1) {
                    amountStr += "s";
                }
            }
            if ('pkg' in dosageItem.dose) {
                if (amountStr != "") {
                    amountStr += " or ";
                }
                amountStr += decimalToFraction(dosageItem.dose.pkg * dosageItem.amount) + " package";
                if (dosageItem.dose.pkg * dosageItem.amount > 1) {
                    amountStr += "s";
                }
            }
            return amountStr;
        };

        var decimalToFraction = function (decimal) {
            if(decimal < (1/4)) {
                return "1/8";
            }
            
            var units = Math.floor(decimal);
            var remainder = decimal - units;
            
            var remainderStr = "";
            if (remainder < (1/4)) { 
            }
            else if (remainder < (1/3)) {
                remainderStr = "1/4";
            } else if (remainder < (1/2)) {
                 remainderStr = "1/3";      
            } else if (remainder < (2/3)) {
                 remainderStr = "1/2";      
            } else if (remainder < (3/4)) {
                 remainderStr = "2/3";      
            } else {
                 remainderStr = "3/4";      
            }
            
            if (units > 0) {
                return units.toString() + " " + remainderStr;
            } else {
                return remainderStr;
            }
        };

        $(function () {
            $("#calculate-btn").click(function () {
                calculateResult();
                $("#dosages-div").removeAttr('hidden');
            });

            $("#print-btn").click(function () {

                var prtContent = document.getElementById("print-div");
                var winPrint = window.open('', '', 'left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0');
                winPrint.document.write(prtContent.innerHTML);
                winPrint.document.close();
                winPrint.focus();
                winPrint.print();
                winPrint.close();
            });
        });

        $('.decimal').keyup(function () {
            var val = $(this).val();
            if (isNaN(val)) {
                val = val.replace(/[^0-9\.]/g, '');
                if (val.split('.').length > 2)
                    val = val.replace(/\.+$/, "");
            }
            $(this).val(val);
        });
    </script>

</body>
</html>
